<div class="container-fluid">
  <p id="notice"><%= flash[:notice] %></p>

  <div class="row">

    <div class="main-visual">
      <div class="main-visual-content d-flex justify-content-center align-items-center flex-column">
        <h1 class="font-weight-bold mb-3"><%= image_tag "favicon.ico", size: '55x55' %> <span class="mx-auto">Ruraloos</span> <%= image_tag "favicon.ico", size: '55x55' %></h1>
        <h3>地方移住に関心がある人のためのレビューサイト</h3>
        <a class="btn btn-dark btn-lg rounded-pill mt-3 go-map", href="#map-container">住んでみたい地域を選ぶ</a>
      </div>
    </div>

  </div>

  <div class="row">

      <div class="sub-visual">
        <div class="sub-visual-content">
          <h2 class="pt-4 text-center font-weight-bold">新着投稿</h2>
          <div class="d-flex justify-content-center align-items-center mb-4">
            <% @posts.each do |post| %>
              <div class="mt-3 mx-3" >
                <div class="card" style="width: 16rem" >
                  <%= attachment_image_tag post, :image, class: "card-img-top", style: "width: 100%", fallback: "No_Picture.png" %>
                  <div class="card-body">
                    <h5 class="card-title"><%= post.title %></h5>
                    <div id="star-rate-<%= post.id %>">満足度：</div>
                    <script>
                    $('#star-rate-<%= post.id %>').raty({
                      size: 36,
                      starOff:  '<%= asset_path('star-off.png') %>',
                      starOn : '<%= asset_path('star-on.png') %>',
                      starHalf: '<%= asset_path('star-half.png') %>',
                      half: true,
                      readOnly: true,
                      score: <%= post.evaluation %>,
                    });
                    </script>
                    <p class="card-text mt-3">地域：<%= post.city %></p>
                    <p class="card-text mt-2"><%= post.body.truncate(20) %></p>
                    <%= link_to "この投稿を読む", post_path(post), class: "btn btn-primary rounded-pill" %>
                  </div>
                  <div class="card-footer">
                    <small class="text-muted">
                      <%= link_to user_path(post.user) do %>
                        <%= attachment_image_tag post.user, :profile_image, class:"rounded-circle mr-1", fallback: "no_image.png", size: "30x30" %><%= post.user.name %>さん
                      <% end %>
                        によって<%= post.updated_at.strftime('%Y/%m/%d') %>に書かれました
                    </small>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
          <p class="text-center"><%= link_to "全ての投稿を見る", all_posts_posts_path, class: "font-weight-bold text-white", style: "font-size:18px;" %></p>
        </div>
      </div>

  </div>



  <div class="row map-visual">

    <div class="mx-auto py-5">
      <div id="map-container"></div>
    </div>

  </div>

</div>


<script>
  $(function(){
    $(".go-map").on("click", function() {
      $("html,body").animate({scrollTop:$('#map-container').offset().top},'slow');
      return false;
  });
  });
</script>

<script>
  $(function(){
      var areas = [
          {code : 1, name: "北海道地方", color: "#7f7eda", hoverColor: "#b3b2ee", prefectures: [1]},
          {code : 2, name: "東北地方",   color: "#759ef4", hoverColor: "#98b9ff", prefectures: [2,3,4,5,6,7]},
          {code : 3, name: "関東地方",   color: "#7ecfea", hoverColor: "#b7e5f4", prefectures: [8,9,10,11,12,13,14]},
          {code : 4, name: "中部地方",   color: "#7cdc92", hoverColor: "#aceebb", prefectures: [15,16,17,18,19,20,21,22,23]},
          {code : 5, name: "近畿地方",   color: "#ffe966", hoverColor: "#fff19c", prefectures: [24,25,26,27,28,29,30]},
          {code : 6, name: "中国地方",   color: "#ffcc66", hoverColor: "#ffe0a3", prefectures: [31,32,33,34,35]},
          {code : 7, name: "四国地方",   color: "#fb9466", hoverColor: "#ffbb9c", prefectures: [36,37,38,39]},
          {code : 8, name: "九州地方",   color: "#ff9999", hoverColor: "#ffbdbd", prefectures: [40,41,42,43,44,45,46]},
          {code : 9, name: "沖縄地方",   color: "#eb98ff", hoverColor: "#f5c9ff", prefectures: [47]},
      ];

      var areaLinks = {
  		"北海道地方" : "/region/hokkaido",
  		"東北地方" : "/region/tohoku",
  		"関東地方" : "/region/kanto",
  		"中部地方" : "/region/chubu",
  		"近畿地方" : "/region/kinki",
  		"中国地方" : "/region/chugoku",
  		"四国地方" : "/region/shikoku",
  		"九州地方" : "/region/kyusyu",
  		"沖縄地方" : "/region/okinawa",
  	};

      $("#map-container").japanMap({
              areas  : areas,
              selection : "area",
              borderLineWidth: 0.25,
              drawsBoxLine : false,
              movesIslands : true,
              showsAreaName : true,
              width: 800,
              font : "MS Mincho",
              fontSize : 16,
              fontColor : "areaColor",
              fontShadowColor : "black",
              onSelect : function(data){
              location.href = areaLinks[data.area.name];
          }
      });
  });
</script>
